<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUTO API GO/PRISMA - Ã‰tape 1 : Initialisation</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; background-color: #f4f4f9; }
        h1, h2 { color: #333; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        code { background-color: #eee; padding: 2px 4px; border-radius: 3px; }
        pre { background-color: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .command { color: #007bff; font-weight: bold; }
        .folder { color: #008000; }
    </style>
</head>
<body>

    <h1>Ã‰tape 1 : Initialisation du Projet Go & Prisma</h1>
    <p>Bienvenue dans ce tutoriel de construction d'une API RESTful en Go, utilisant Prisma pour l'accÃ¨s Ã  PostgreSQL. Nous allons crÃ©er une API pour la gestion de produits cosmÃ©tiques avec des rÃ´les (Admin/User).</p>

    <h2>1. PrÃ©requis et DÃ©marrage du Projet</h2>
    <ul>
        <li>Avoir Go installÃ© (version 1.18+ recommandÃ©e).</li>
        <li>Avoir Node.js/npm (nÃ©cessaire pour l'outil CLI de Prisma).</li>
        <li>Avoir Docker ou une instance PostgreSQL accessible.</li>
        <li>Ouvrez votre terminal et initialisez votre module Go :<pre><code class="command">go mod init backend</code></pre></li>
        <li>Installez le client Go pour Prisma et le routeur Chi :<pre><code class="command">go get github.com/steebchen/prisma-client-go github.com/go-chi/chi/v5 github.com/joho/godotenv golang.org/x/crypto/bcrypt github.com/golang-jwt/jwt/v5</code></pre></li>
    </ul>

    <h2>2. Arborescence des Fichiers (Structure du Projet)</h2>
    <p>Nous utilisons la convention **Standard Go Project Layout** (`/internal`, `/cmd`) pour une meilleure organisation et maintenabilitÃ©. Votre structure est excellente :</p>
    <pre>
<span class="folder">ğŸ“¦backend</span>
 â”£ ğŸ“‚<span class="folder">internal</span>
 â”ƒ â”£ ğŸ“‚<span class="folder">handlers</span>      <span class="folder">// GÃ¨re les requÃªtes HTTP (ContrÃ´leurs)</span>
 â”ƒ â”£ ğŸ“‚<span class="folder">middlewares</span>   <span class="folder">// Fonctions de traitement des requÃªtes (JWT, RÃ´les)</span>
 â”ƒ â”£ ğŸ“‚<span class="folder">models</span>        <span class="folder">// Structures Go pour la sÃ©rialisation/dÃ©sÃ©rialisation</span>
 â”ƒ â”£ ğŸ“‚<span class="folder">routes</span>        <span class="folder">// DÃ©finition centralisÃ©e des chemins d'API</span>
 â”ƒ â”£ ğŸ“‚<span class="folder">services</span>      <span class="folder">// Logique mÃ©tier et interaction avec la DB via Prisma</span>
 â”ƒ â”— ğŸ“‚<span class="folder">utils</span>         <span class="folder">// Fonctions d'aide (rÃ©ponses JSON, erreurs, etc.)</span>
 â”£ ğŸ“‚<span class="folder">prisma</span>        <span class="folder">// Fichiers de configuration de Prisma</span>
 â”ƒ â”— ğŸ“œ<span class="folder">schema.prisma</span>
 â”£ ğŸ“œ<span class="folder">.env</span>          <span class="folder">// Variables d'environnement</span>
 â”£ ğŸ“œ<span class="folder">main.go</span>       <span class="folder">// Le point d'entrÃ©e de l'application (func main)</span>
 â”— ğŸ“œ<span class="folder">README.md</span>
    </pre>

    <h2>3. Initialisation de Prisma et Configuration</h2>
    <p>Nous allons initialiser Prisma et dÃ©finir les modÃ¨les de base pour l'utilisateur et les produits.</p>

    <h3>3.1 Fichier <code>.env</code></h3>
    <p>CrÃ©ez le fichier <code>.env</code> Ã  la racine et renseignez votre URL de connexion PostgreSQL ainsi que le secret JWT :</p>
    <pre><code>
PORT=8080
DATABASE_URL="postgresql://user:password@localhost:5432/cosmetics_db?schema=public"
JWT_SECRET="UnSecretTresLongEtAleatoirePourJWT"
    </code></pre>

    <h3>3.2 Lancement de Prisma</h3>
    <p>Initialisez l'environnement Prisma dans votre projet :</p>
    <pre><code class="command">npx prisma init</code></pre>

    <h2>4. ModÃ©lisation de la Base de DonnÃ©es (schema.prisma)</h2>
    <p>Ã‰ditez le fichier <code>prisma/schema.prisma</code> pour y inclure les modÃ¨les <code>User</code> (avec gestion des rÃ´les) et <code>Product</code> :</p>
    <pre><code>
// prisma/schema.prisma
// ... (Les premiÃ¨res lignes generator et datasource restent les mÃªmes) ...

generator go {
  provider = "go run github.com/steebchen/prisma-client-go"
  // On spÃ©cifie oÃ¹ sera gÃ©nÃ©rÃ© le client Go pour qu'il soit interne au projet
  output   = "./internal/db" 
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// L'Ã©numÃ©ration pour gÃ©rer les rÃ´les
enum Role {
  USER
  ADMIN
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String    // Mot de passe hachÃ© (bcrypt)
  role      Role      @default(USER) // RÃ´le par dÃ©faut
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[] // Relation : un utilisateur peut avoir crÃ©Ã© plusieurs produits
}

model Product {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  price       Float    @default(0.0)
  stock       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relation Ã  l'utilisateur qui a crÃ©Ã©/modifiÃ© le produit
  authorId    String
  author      User     @relation(fields: [authorId], references: [id])
}
    </code></pre>

    <h2>5. GÃ©nÃ©ration du Client Go et Migration</h2>
    <p>AprÃ¨s avoir dÃ©fini le schÃ©ma, gÃ©nÃ©rez le client Go (dans <code>internal/db</code>) et appliquez les changements Ã  votre base de donnÃ©es PostgreSQL :</p>
    <pre><code class="command">npx prisma generate
npx prisma migrate dev --name init_models</code></pre>
    <p>Le client Go est maintenant prÃªt Ã  Ãªtre importÃ© !</p>

</body>
</html>